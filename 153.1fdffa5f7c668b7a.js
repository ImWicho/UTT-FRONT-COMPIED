"use strict";(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[153],{9153:(st,g,s)=>{s.r(g),s.d(g,{RequestModule:()=>it});var p=s(9808),h=s(2302),q=s(655),v=s(6087),I=s(4847),c=s(6346),m=s(7991),r=s(3075),t=s(5e3),_=s(3628),f=s(2340),S=s(520);let T=(()=>{class e{constructor(o){this.http=o}onGetRequests(){return this.http.get(`${f.N.API_URL}/api/v1/requests`)}onSaveRequest(o){return this.http.post(`${f.N.API_URL}/api/v1/requests`,o)}onUpdateRequestStatus(o){return this.http.post(`${f.N.API_URL}/api/v1/update-req`,o)}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(S.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var A=s(7161),l=s(8966),d=s(7322),b=s(4107),C=s(7531),x=s(7423),N=s(508);function D(e,n){if(1&e&&(t.TgZ(0,"mat-option",17),t._uU(1),t.qZA()),2&e){const o=n.$implicit;t.Q6J("value",o.id),t.xp6(1),t.AsE(" ",o.nombre," - ",o.version," ")}}let U=(()=>{class e{constructor(o,i,a,u,R){this.fb=o,this.docService=i,this.service=a,this.notificationService=u,this.dialog=R,this.isLoading=!1,this.documents=[],this.buildForm()}ngOnInit(){this.onGetDocs()}sendData(){if(this.form.invalid)return;this.isLoading=!0;const o=Object.assign({},this.form.value);this.service.onSaveRequest(o).subscribe(i=>{this.notificationService.onShowNotification({title:"Solicitud creada",desc:"La solicitud se ha creado correctamente.",type:m.d.SUCCESS}),this.dialog.close(!0)},i=>{this.isLoading=!1,this.notificationService.onShowNotification({title:"Ocurri\xf3 un error",desc:"Intente m\xe1s tarde o contacte a soporte.",type:m.d.DANGER})})}buildForm(){this.form=this.fb.group({documentoId:[null,[r.kI.required]],nombre:[null,[r.kI.required]],version:[null,[r.kI.required]],puntoCambio:[null,[r.kI.required]],descripcionActual:[null,[r.kI.required]],descripcionCambio:[null,[r.kI.required]]})}onGetDocs(){this.docService.onGetDocuments().subscribe(o=>{this.documents=o})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(r.qu),t.Y36(_.R),t.Y36(T),t.Y36(A.g),t.Y36(l.so))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-request-dialog"]],decls:41,vars:6,consts:[["mat-dialog-title",""],[1,"mat-typography"],[3,"formGroup"],[1,"row"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12"],["appearance","outline"],["formControlName","documentoId"],[3,"value",4,"ngFor","ngForOf"],[1,"col-xs-12","col-sm-12","col-md-6","col-lg-6"],["matInput","","placeholder","Nombre","formControlName","nombre"],["matInput","","placeholder","Versi\xf3n","formControlName","version"],["matInput","","placeholder","Punto cambio","formControlName","puntoCambio"],["matInput","","placeholder","Descripci\xf3n actual","formControlName","descripcionActual"],["matInput","","placeholder","Descripci\xf3n cambio","formControlName","descripcionCambio"],["align","end"],["mat-flat-button","",3,"mat-dialog-close"],["mat-flat-button","","color","primary",3,"disabled","click"],[3,"value"]],template:function(o,i){1&o&&(t.TgZ(0,"h2",0),t._uU(1,"Crear solicitud"),t.qZA(),t.TgZ(2,"mat-dialog-content",1),t.TgZ(3,"form",2),t.TgZ(4,"div",3),t.TgZ(5,"div",4),t.TgZ(6,"mat-form-field",5),t.TgZ(7,"mat-label"),t._uU(8,"Documento"),t.qZA(),t.TgZ(9,"mat-select",6),t.YNc(10,D,2,3,"mat-option",7),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div",8),t.TgZ(12,"mat-form-field",5),t.TgZ(13,"mat-label"),t._uU(14,"Nombre"),t.qZA(),t._UZ(15,"input",9),t.qZA(),t.qZA(),t.TgZ(16,"div",8),t.TgZ(17,"mat-form-field",5),t.TgZ(18,"mat-label"),t._uU(19,"Versi\xf3n"),t.qZA(),t._UZ(20,"input",10),t.qZA(),t.qZA(),t.TgZ(21,"div",8),t.TgZ(22,"mat-form-field",5),t.TgZ(23,"mat-label"),t._uU(24,"Punto cambio"),t.qZA(),t._UZ(25,"input",11),t.qZA(),t.qZA(),t.TgZ(26,"div",8),t.TgZ(27,"mat-form-field",5),t.TgZ(28,"mat-label"),t._uU(29,"Descripci\xf3n actual"),t.qZA(),t._UZ(30,"input",12),t.qZA(),t.qZA(),t.TgZ(31,"div",4),t.TgZ(32,"mat-form-field",5),t.TgZ(33,"mat-label"),t._uU(34,"Descripci\xf3n cambio"),t.qZA(),t._UZ(35,"input",13),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(36,"mat-dialog-actions",14),t.TgZ(37,"button",15),t._uU(38,"Cancelar"),t.qZA(),t.TgZ(39,"button",16),t.NdJ("click",function(){return i.sendData()}),t._uU(40," Aceptar "),t.qZA(),t.qZA()),2&o&&(t.xp6(3),t.Q6J("formGroup",i.form),t.xp6(7),t.Q6J("ngForOf",i.documents),t.xp6(27),t.Q6J("mat-dialog-close",!1),t.xp6(2),t.ekj("spinner",i.isLoading),t.Q6J("disabled",i.form.invalid||i.isLoading))},directives:[l.uh,l.xY,r._Y,r.JL,r.sg,d.KE,d.hX,b.gD,r.JJ,r.u,p.sg,C.Nt,r.Fj,l.H8,x.lW,l.ZT,N.ey],styles:[""]}),e})();var y=s(6155),Y=s(6727),F=s(5245),Z=s(2531);function Q(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," ID "),t.qZA())}function w(e,n){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",o.id," ")}}function E(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," NOMBRE "),t.qZA())}function G(e,n){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,o.nombre)," ")}}function J(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," VERSION "),t.qZA())}function O(e,n){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,o.version)," ")}}function L(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," PUNTO CAMBIO "),t.qZA())}function M(e,n){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,o.punto_cambio)," ")}}function B(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," ACTUAL DESC "),t.qZA())}function j(e,n){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,o.descripcion_actual)," ")}}function P(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," CAMBIO DESC "),t.qZA())}function $(e,n){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,o.descripcion_cambio)," ")}}function k(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," ESTATUS "),t.qZA())}function z(e,n){if(1&e&&(t.TgZ(0,"td",28),t._uU(1),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ","pendient"===o.status?"PENDIENTE":"APROBADO"," ")}}function H(e,n){1&e&&(t.TgZ(0,"th",27),t._uU(1," OPCIONES "),t.qZA())}function X(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"td",28),t.TgZ(1,"button",29),t._UZ(2,"mat-icon",30),t.qZA(),t.TgZ(3,"mat-menu",null,31),t.TgZ(5,"button",32),t.NdJ("click",function(){const u=t.CHM(o).$implicit;return t.oxw().updateStatus(u)}),t._UZ(6,"mat-icon",33),t.TgZ(7,"span"),t._uU(8,"Aprobar solicitud"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=n.$implicit,i=t.MAs(4),a=t.oxw();t.xp6(1),t.Q6J("matMenuTriggerFor",i),t.xp6(4),t.Q6J("disabled","2"!==(null==a.user?null:a.user.role_id)&&"1"!==(null==a.user?null:a.user.role_id)||"approved"===o.status)}}function V(e,n){1&e&&t._UZ(0,"tr",34)}function W(e,n){1&e&&t._UZ(0,"tr",35)}function K(e,n){if(1&e&&(t.TgZ(0,"tr",36),t.TgZ(1,"td",37),t._uU(2),t.qZA(),t.qZA()),2&e){t.oxw();const o=t.MAs(16);t.xp6(2),t.hij('No se encontraron registros "',o.value,'"')}}const tt=function(){return[10,25,100]},et=[{path:"",component:(()=>{class e{constructor(o,i,a,u){this.service=o,this.dialogService=i,this.store=a,this.notificationService=u,this.displayedColumns=["id","nombre","version","punto_cambio","descripcion_actual","descripcion_cambio","status","options"],this.requests=[]}ngOnInit(){this.onGetDocs(),this.subs=this.store.select("user").subscribe(o=>this.user=o.user)}openDialog(){return(0,q.mG)(this,void 0,void 0,function*(){(yield this.dialogService.onShowDialog(U,{width:800}).toPromise())&&this.onGetDocs()})}ngOnDestroy(){this.subs.unsubscribe()}updateStatus(o){return(0,q.mG)(this,void 0,void 0,function*(){(yield this.dialogService.onShowConfirmation({title:"\xbfEst\xe1s seguro de aprovar el documento?",desc:"El documento cambiar\xe1 a Aprovado",icon:"alert-circle-outline"}).toPromise())&&this.service.onUpdateRequestStatus({requestId:o.id,status:"approved",docId:o.documento_id}).subscribe(i=>{this.onGetDocs(),this.notificationService.onShowNotification({title:"Solicitud actualizada",desc:"La solicitud se ha actualizado correctamente.",type:m.d.SUCCESS})},i=>{this.notificationService.onShowNotification({title:"Ocurri\xf3 un error",desc:"Intente m\xe1s tarde o contacte a soporte.",type:m.d.DANGER})})})}onGetDocs(){this.service.onGetRequests().subscribe(o=>{this.requests=o,this.setData()})}setData(){this.dataSource=new c.by,this.dataSource.data=this.requests,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(o){this.dataSource.filter=o.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(T),t.Y36(y.x),t.Y36(Y.yh),t.Y36(A.g))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-request-index"]],viewQuery:function(o,i){if(1&o&&(t.Gf(v.NW,5),t.Gf(I.YE,5)),2&o){let a;t.iGM(a=t.CRH())&&(i.paginator=a.first),t.iGM(a=t.CRH())&&(i.sort=a.first)}},decls:49,vars:6,consts:[[1,"container-fluid"],[1,"row"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12"],[1,"col-xs-12","col-sm-12","col-md-6","col-lg-6","row","middle-xs","between-xs"],["mat-flat-button","","color","primary",3,"disabled","click"],["mat-icon-button","",3,"click"],["svgIcon","refresh"],[1,"col-xs-12","col-sm-12","col-md-6","col-lg-6"],["appearance","standard"],["matInput","","placeholder","Ex. Sistemas",3,"keyup"],["input",""],[1,"table-responsive"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","version"],["matColumnDef","punto_cambio"],["matColumnDef","descripcion_actual"],["matColumnDef","descripcion_cambio"],["matColumnDef","status"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of docs",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","dots-vertical"],["menu","matMenu"],["mat-menu-item","",3,"disabled","click"],["svgIcon","file-refresh"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"h2"),t._uU(4,"Solicitudes"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(5,"div",1),t.TgZ(6,"div",3),t.TgZ(7,"button",4),t.NdJ("click",function(){return i.openDialog()}),t._uU(8,"Crear solicitud"),t.qZA(),t.TgZ(9,"button",5),t.NdJ("click",function(){return i.onGetDocs()}),t._UZ(10,"mat-icon",6),t.qZA(),t.qZA(),t.TgZ(11,"div",7),t.TgZ(12,"mat-form-field",8),t.TgZ(13,"mat-label"),t._uU(14,"Buscar"),t.qZA(),t.TgZ(15,"input",9,10),t.NdJ("keyup",function(u){return i.applyFilter(u)}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"div",1),t.TgZ(18,"div",2),t.TgZ(19,"div",11),t.TgZ(20,"table",12),t.ynx(21,13),t.YNc(22,Q,2,0,"th",14),t.YNc(23,w,2,1,"td",15),t.BQk(),t.ynx(24,16),t.YNc(25,E,2,0,"th",14),t.YNc(26,G,3,3,"td",15),t.BQk(),t.ynx(27,17),t.YNc(28,J,2,0,"th",14),t.YNc(29,O,3,3,"td",15),t.BQk(),t.ynx(30,18),t.YNc(31,L,2,0,"th",14),t.YNc(32,M,3,3,"td",15),t.BQk(),t.ynx(33,19),t.YNc(34,B,2,0,"th",14),t.YNc(35,j,3,3,"td",15),t.BQk(),t.ynx(36,20),t.YNc(37,P,2,0,"th",14),t.YNc(38,$,3,3,"td",15),t.BQk(),t.ynx(39,21),t.YNc(40,k,2,0,"th",14),t.YNc(41,z,2,1,"td",15),t.BQk(),t.ynx(42,22),t.YNc(43,H,2,0,"th",14),t.YNc(44,X,9,2,"td",15),t.BQk(),t.YNc(45,V,1,0,"tr",23),t.YNc(46,W,1,0,"tr",24),t.YNc(47,K,3,1,"tr",25),t.qZA(),t._UZ(48,"mat-paginator",26),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o&&(t.xp6(7),t.Q6J("disabled","2"===(null==i.user?null:i.user.role_id)||"4"===(null==i.user?null:i.user.role_id)),t.xp6(13),t.Q6J("dataSource",i.dataSource),t.xp6(25),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(2),t.Q6J("pageSizeOptions",t.DdM(5,tt)))},directives:[x.lW,F.Hw,d.KE,d.hX,C.Nt,c.BZ,c.w1,c.fO,c.Dz,c.as,c.nj,c.Ee,v.NW,c.ge,c.ev,Z.p6,Z.VK,Z.OP,c.XQ,c.Gk],pipes:[p.gd],styles:[""]}),e})()}];let ot=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[h.Bz.forChild(et)],h.Bz]}),e})();var nt=s(9336);let it=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,ot,nt.q,r.UX]]}),e})()}}]);